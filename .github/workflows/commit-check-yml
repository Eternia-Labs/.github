name: Enforce Jira ID in Commit

on:
  push:
    branches: ["*"]

jobs:
  commit-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate commit messages
        run: |
          regex='(ET|MST|MR)-[0-9]+'
          for commit in $(git log --format='%s' ${{ github.event.before }}..${{ github.sha }}); do
            if ! echo "$commit" | grep -Eq "$regex"; then
              echo "Commit message '$commit' does not contain a Jira ID! Jira ID is must in the commit message."
              echo "<Jira ID>: <Commit message>"
              exit 1
            fi
          done
